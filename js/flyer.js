// Generated by CoffeeScript 1.4.0
(function() {

  define(["paper"], function(paper) {
    var Flyer, Point;
    Point = paper.Point;
    return Flyer = (function() {

      Flyer.prototype.onPath = true;

      Flyer.prototype.minXVel = 1;

      function Flyer(path) {
        this.path = path;
        this.pos = this.path.at(this.path.start);
        this.vel = new Point(this.minXVel, 0);
        this.acc = new Point(0, -1);
      }

      Flyer.prototype.go = function(dt) {
        var pathGrad;
        this.vel = this.vel.add(this.acc.multiply(dt));
        this.vel.x = Math.max(this.vel.x, this.minXVel);
        if (this.onPath) {
          pathGrad = this.path.grad(this.pos.x);
          if (pathGrad.getDirectedAngle(this.vel) > 0) {
            this.onPath = false;
          } else {
            this.vel = pathGrad.normalize(this.vel.getLength());
            this.pos = this.path.at(this.pos.add(this.vel.multiply(dt)).x);
          }
        }
        if (!this.onPath) {
          this.pos = this.pos.add(this.vel.multiply(dt));
          if (this.pos.y < this.path.at(this.pos.x).y) {
            this.vel = this.vel.project(this.path.grad(this.pos.x));
            this.pos = this.path.at(this.pos.x);
            this.onPath = true;
          }
        }
        return this.pos;
      };

      return Flyer;

    })();
  });

}).call(this);
